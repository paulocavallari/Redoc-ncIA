{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the redocÃªncIA application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "username": {
          "type": "string",
          "description": "The user's username for login."
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "username"
      ]
    },
    "LessonPlan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LessonPlan",
      "type": "object",
      "description": "Represents a lesson plan generated by the AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the LessonPlan entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N LessonPlan)"
        },
        "educationLevel": {
          "type": "string",
          "description": "The education level for the lesson plan (e.g., Ensino Fundamental: Anos Iniciais)."
        },
        "year": {
          "type": "string",
          "description": "The year/serie for the lesson plan."
        },
        "subject": {
          "type": "string",
          "description": "The subject for the lesson plan."
        },
        "content": {
          "type": "string",
          "description": "The content covered in the lesson plan."
        },
        "abilities": {
          "type": "array",
          "description": "The abilities covered in the lesson plan.",
          "items": {
            "type": "string"
          }
        },
        "additionalInstructions": {
          "type": "string",
          "description": "Additional instructions provided by the user for the AI."
        },
        "lessonPlanSuggestion": {
          "type": "string",
          "description": "The lesson plan suggested by the AI."
        }
      },
      "required": [
        "id",
        "userId",
        "educationLevel",
        "year",
        "subject",
        "content",
        "abilities",
        "additionalInstructions",
        "lessonPlanSuggestion"
      ]
    },
    "ScopeSequenceData": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ScopeSequenceData",
      "type": "object",
      "description": "Represents the scope sequence data uploaded by the admin.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ScopeSequenceData entity."
        },
        "discipline": {
          "type": "string",
          "description": "The discipline of the scope sequence."
        },
        "year": {
          "type": "string",
          "description": "The year/serie of the scope sequence."
        },
        "semester": {
          "type": "string",
          "description": "The semester of the scope sequence."
        },
        "content": {
          "type": "string",
          "description": "The content of the scope sequence."
        },
        "abilities": {
          "type": "array",
          "description": "The abilities associated with the content.",
          "items": {
            "type": "string"
          }
        },
        "objectives": {
          "type": "string",
          "description": "The objectives of the scope sequence."
        }
      },
      "required": [
        "id",
        "discipline",
        "year",
        "semester",
        "content",
        "abilities",
        "objectives"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. The 'userId' parameter corresponds to the Firebase Auth UID. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/lessonPlans/{lessonPlanId}",
        "definition": {
          "entityName": "LessonPlan",
          "schema": {
            "$ref": "#/backend/entities/LessonPlan"
          },
          "description": "Stores lesson plans created by a user. The 'userId' parameter corresponds to the Firebase Auth UID, and is denormalized into each LessonPlan document for authorization independence. 'lessonPlanId' is the unique ID of the lesson plan.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            },
            {
              "name": "lessonPlanId",
              "description": "The unique ID of the lesson plan."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "adminRole",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "This collection stores documents whose presence indicates the user has admin privileges.  Existence is used for role validation (DBAC).",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the admin user."
            }
          ]
        }
      },
      {
        "path": "/scopeSequenceData/{scopeSequenceDataId}",
        "definition": {
          "entityName": "ScopeSequenceData",
          "schema": {
            "$ref": "#/backend/entities/ScopeSequenceData"
          },
          "description": "Stores the scope sequence data uploaded by the admin. ScopeSequenceDataId is the unique ID of the scope sequence data.",
          "params": [
            {
              "name": "scopeSequenceDataId",
              "description": "The unique ID of the scope sequence data."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to facilitate a secure and scalable application for AI-assisted lesson planning. It adheres to the principles of Authorization Independence, Clarity of Intent, DBAC, and Rules Are Not Filters (QAPs). Authorization Independence is achieved through denormalization where necessary. User data and lesson plans are organized under user-specific paths, ensuring only the authenticated user can access their data. The admin user's profile is also located here, and the admin roles collection facilitates global role validation.\n\nSegregation of concerns is implemented to ensure that different data types with different access patterns are stored in separate collections, simplifying security rules. The structure explicitly models user ownership and admin roles.\n\nThe design anticipates list operations (QAPs) by structuring data in a way that allows filtering based on denormalized attributes within each collection, avoiding the need for complex queries or client-side filtering. All the documents inside the ScopeSequenceData have the same security requirements, and it helps to avoid authorization based on content."
  }
}